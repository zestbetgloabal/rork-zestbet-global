#!/bin/bash

echo "ðŸš€ Complete AWS Lambda Deployment Guide for ZestBet"
echo "=================================================="

echo ""
echo "ðŸ“‹ Step 1: Setup AWS Credentials"
echo "--------------------------------"
echo "1. Install AWS CLI (if not installed):"
echo "   curl 'https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip' -o 'awscliv2.zip'"
echo "   unzip awscliv2.zip"
echo "   sudo ./aws/install"
echo ""
echo "2. Configure AWS credentials:"
echo "   aws configure"
echo "   - AWS Access Key ID: [Your AWS Access Key]"
echo "   - AWS Secret Access Key: [Your AWS Secret Key]"
echo "   - Default region name: eu-central-1"
echo "   - Default output format: json"

echo ""
echo "ðŸ“‹ Step 2: Install Dependencies"
echo "-------------------------------"
echo "1. Install Serverless Framework:"
echo "   npm install -g serverless"
echo ""
echo "2. Install project dependencies:"
echo "   npm install --save-dev serverless-esbuild"

echo ""
echo "ðŸ“‹ Step 3: Deploy to AWS Lambda"
echo "-------------------------------"
echo "1. Make deployment script executable:"
echo "   chmod +x deploy-aws-lambda.sh"
echo ""
echo "2. Run deployment:"
echo "   ./deploy-aws-lambda.sh"

echo ""
echo "ðŸ“‹ Step 4: Update App Configuration"
echo "----------------------------------"
echo "1. After deployment, copy the API Gateway URL"
echo "2. Replace 'YOUR-AWS-API-ID' in eas-aws.json with your actual API ID"
echo "3. Copy eas-aws.json to eas.json:"
echo "   cp eas-aws.json eas.json"
echo ""
echo "4. Update your .env file:"
echo "   EXPO_PUBLIC_API_URL=https://YOUR-API-ID.execute-api.eu-central-1.amazonaws.com"
echo "   EXPO_PUBLIC_TRPC_URL=https://YOUR-API-ID.execute-api.eu-central-1.amazonaws.com/trpc"

echo ""
echo "ðŸ“‹ Step 5: Test Deployment"
echo "-------------------------"
echo "1. Test your API:"
echo "   ./test-aws-lambda.sh"
echo ""
echo "2. Rebuild your app:"
echo "   eas build --platform all"

echo ""
echo "ðŸ“‹ Step 6: Monitor and Manage"
echo "----------------------------"
echo "- View logs: serverless logs -f api"
echo "- Get info: serverless info"
echo "- Remove deployment: serverless remove"

echo ""
echo "ðŸŽ‰ Your ZestBet backend will be running on AWS Lambda!"
echo "âœ… Serverless, scalable, and cost-effective"
echo "âœ… Automatic scaling based on demand"
echo "âœ… Pay only for what you use"